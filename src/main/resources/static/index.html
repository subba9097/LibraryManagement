<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Library Management System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css"> <!-- Linked external CSS -->
</head>
<body class="bg-light text-center">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">üìö Library</a>
      <div class="collapse navbar-collapse justify-content-center">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('homePage')">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('home')">All Books</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('add')">Add Book</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('view')">View Book</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('delete')">Delete Book</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid px-0">

    <!-- Home Page -->
    <div id="homePage" class="section">
      <h1 class="text-warning">Welcome to Library Management</h1>
      <p class="lead">Search, add, and manage your books effortlessly.</p>
      <div class="row justify-content-center mt-4">
        <div class="col-md-4"><img src="img/library1.jpg" class="img-fluid rounded shadow" alt="Library 1"></div>
        <div class="col-md-4"><img src="img/library2.jpg" class="img-fluid rounded shadow" alt="Library 2"></div>
        <div class="col-md-4"><img src="img/library3.jpg" class="img-fluid rounded shadow" alt="Library 3"></div>
      </div>
    </div>

    <!-- All Books -->
    <div id="home" class="section hidden">
      <h2 class="text-warning">All Books</h2>
      <div class="table-responsive">
        <table class="table table-bordered table-striped bg-white text-dark mt-3">
          <thead class="table-dark">
            <tr>
              <th>ID</th><th>Title</th><th>Author</th><th>Category</th><th>Year</th><th>Issued</th>
            </tr>
          </thead>
          <tbody id="bookTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Add Book -->
    <div id="add" class="section hidden">
      <h2 class="text-success">Add a Book</h2>
      <form id="bookForm" class="mx-auto bg-light text-dark p-4 rounded shadow" style="max-width: 500px;">
        <input type="text" id="title" class="form-control mb-2" placeholder="Title" required>
        <input type="text" id="author" class="form-control mb-2" placeholder="Author" required>
        <input type="text" id="category" class="form-control mb-2" placeholder="Category" required>
        <input type="number" id="year" class="form-control mb-2" placeholder="Year" required>
        <div class="form-check mb-3 text-start">
          <input type="checkbox" class="form-check-input" id="issued">
          <label for="issued" class="form-check-label">Issued</label>
        </div>
        <button type="submit" class="btn btn-primary w-100">Add Book</button>
        <p id="message" class="mt-3"></p>
      </form>
    </div>

    <!-- View Book -->
    <div id="view" class="section hidden">
      <h2 class="text-info">View Book by ID</h2>
      <div class="input-group mb-3 justify-content-center" style="max-width: 400px; margin: auto;">
        <input type="number" id="viewId" class="form-control" placeholder="Enter Book ID">
        <button onclick="getBook()" class="btn btn-outline-info">Search</button>
      </div>
      <div id="bookDetails" class="text-start" style="max-width: 500px; margin: auto;"></div>
    </div>

    <!-- Delete Book -->
    <div id="delete" class="section hidden">
      <h2 class="text-danger">Delete Book by ID</h2>
      <div class="input-group mb-3 justify-content-center" style="max-width: 400px; margin: auto;">
        <input type="number" id="deleteId" class="form-control" placeholder="Enter Book ID">
        <button onclick="deleteBook()" class="btn btn-outline-danger">Delete</button>
      </div>
      <p id="deleteMessage"></p>
    </div>

  </div>

  <script>
    function showSection(id) {
      document.querySelectorAll('.container-fluid > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if (id === 'home') fetchBooks();
    }

    function fetchBooks() {
      fetch("/books")
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#bookTableBody");
          tbody.innerHTML = "";
          data.forEach(book => {
            const row = `<tr>
              <td>${book.id}</td>
              <td>${book.title}</td>
              <td>${book.author}</td>
              <td>${book.category}</td>
              <td>${book.year}</td>
              <td>${book.issued ? "Yes" : "No"}</td>
            </tr>`;
            tbody.innerHTML += row;
          });
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      showSection('homePage');
      document.getElementById("bookForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const book = {
          title: document.getElementById("title").value,
          author: document.getElementById("author").value,
          category: document.getElementById("category").value,
          year: parseInt(document.getElementById("year").value),
          issued: document.getElementById("issued").checked
        };
        fetch("/books", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(book)
        }).then(res => {
          document.getElementById("message").textContent = res.ok ? "‚úÖ Book added!" : "‚ùå Failed to add.";
          this.reset();
        });
      });
    });

    function getBook() {
      const id = document.getElementById("viewId").value;
      fetch(`/books/${id}`)
        .then(res => res.ok ? res.json() : Promise.reject("Not found"))
        .then(book => {
          document.getElementById("bookDetails").innerHTML = `
            <div class="card mt-3 shadow">
              <div class="card-body">
                <h5 class="card-title">${book.title}</h5>
                <p><strong>Author:</strong> ${book.author}</p>
                <p><strong>Category:</strong> ${book.category}</p>
                <p><strong>Year:</strong> ${book.year}</p>
                <p><strong>Issued:</strong> ${book.issued ? "Yes" : "No"}</p>
              </div>
            </div>`;
        })
        .catch(() => {
          document.getElementById("bookDetails").innerHTML = `<p class="text-danger">Book not found</p>`;
        });
    }

    function deleteBook() {
      const id = document.getElementById("deleteId").value;
      fetch(`/books/${id}`, { method: "DELETE" })
        .then(res => {
          document.getElementById("deleteMessage").textContent =
            res.ok ? "‚úÖ Book deleted." : "‚ùå Deletion failed.";
        });
    }
  </script>
</body>
</html>
